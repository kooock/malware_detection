import re
import dir
import count

def extract_unigram_print_file(path):
    f = open(path,'r')
    data = f.read()
    f.close()

    f = open("./unigrams.list",'a')
    unigrams = re.split('\W+', data)
    for unigram in unigrams:
        if unigram == '':
            continue

        f.write(unigram+'\n')
    f.close()

def extract_unigram(path):
    f = open(path,'r')
    data = f.read()
    f.close()

    unigrams = re.split('\W+', data)
    out_list = list(unigrams)
    for unigram in unigrams:
        if unigram == '':
            out_list.remove(unigram)
    return out_list



def extract_unigram_dir(dir_path):
    filenames = dir.filenames_in_dir(dir_path)
    for filename in filenames:
        extract_unigram_print_file(filename)
    print "func extract_unigram_dir => done"
    return filenames

def extract_unigram_dir_only_json(dir_path):
    filenames = dir.json_filenames_in_dir(dir_path)
    unigrams_list = []
    i = 1;
    for filename in filenames:
        extract_unigram(filename)
        print "extract json file : " + str(i)
        i +=1
    return filenames

def extract_most_appeared_unigrams_dir_only_json(target_dir,count_num):
    filenames = extract_unigram_dir_only_json(target_dir)
    remove_all_file_appeared(filenames)
    counting_dict={}
    counting_dict = count.count_single_list(counting_dict)

    top_list = count.most_appreared_in_dict(dict=counting_dict,top_num=count_num)
    print top_list
    return top_list

def remove_all_file_appeared(filenames):

    f = open("./unigrams.list",'r')
    f2 = open("./unigrams.reduce",'w')
    while True:
        unigram = f.readline()
        if not unigram:
            break
        if unigram[-1] == '\n':
            unigram = unigram[0:-1]

        print "func remove_all_file_appeared => unigrams_in file : "+unigram
        if is_appear_all_files(unigram,filenames):
            print "func remove_all_file_appeared => removed unigram : "+unigram
            continue
        else:
            f2.write(unigram+'\n')
    f.close()
    f2.close()


def is_appear_single_file(unigram,filename):
    unigrams_in_file = extract_unigram(filename)
    for unigram_in_file in unigrams_in_file:
        if unigram_in_file == unigram:
            return True
        else:
            continue
    return False

def is_appear_all_files(unigram,filenames):
    for file in filenames:
        if is_appear_single_file(unigram,file):
            continue
        else:
            return False
    return True