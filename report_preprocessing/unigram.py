import re
import dir
import count

def extract_unigram(path):
    f = open(path,'r')
    data = f.read()
    f.close()
    unigrams = re.split('\W+', data)
    for unigram in unigrams:
        if unigram == '':
            unigrams.remove(unigram)
    return unigrams

def extract_unigram_dir(dir_path):
    filenames = dir.filenames_in_dir(dir_path)
    unigrams_list = []
    for filename in filenames:
        unigrams_list +=  extract_unigram(filename)
    return filenames, unigrams_list

def extract_unigram_dir_only_json(dir_path):
    filenames = dir.json_filenames_in_dir(dir_path)
    unigrams_list = []
    for filename in filenames:
        unigrams_list +=  extract_unigram(filename)
    return filenames, unigrams_list


def extract_most_appeared_unigrams_dir(target_dir,count_num):
    filenames, unigrams_list = extract_unigram_dir(target_dir)
    counting_dict={}
    for unigrams in unigrams_list:
        count.count_single_list(unigrams,counting_dict)
    top_list = count.most_appreared_in_dict(dict=counting_dict,top_num=count_num)
    return top_list

def extract_most_appeared_unigrams_dir_only_json(target_dir,count_num):
    filenames, unigrams = extract_unigram_dir_only_json(target_dir)
    unigrams =  remove_all_file_appeared(unigrams,filenames)
    counting_dict={}
    count.count_single_list(unigrams,counting_dict)

    top_list = count.most_appreared_in_dict(dict=counting_dict,top_num=count_num)
    print top_list
    return top_list

def remove_all_file_appeared(unigrams_list,filenames):
    output_list = list(unigrams_list)
    for unigram in unigrams_list:
        if is_appear_all_files(unigram,filenames):
            output_list.remove(unigram)
    return output_list



def is_appear_single_file(unigram,filename):
    unugrams_in_file = extract_unigram(filename)
    for unigram_in_file in unugrams_in_file:
        if unigram_in_file == unigram:
            return True
        else:
            continue
    return False

def is_appear_all_files(unigram,filenames):
    for file in filenames:
        if is_appear_single_file(unigram,file):
            continue
        else:
            return False
    return True